<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾å›¾æ¬£èµ - ç²¾ç¾å›¾ç‰‡å±•ç¤º</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <button class="back-to-top">â†‘</button>
    <button class="theme-toggle">åˆ‡æ¢ä¸»é¢˜</button>

    <div class="container">
        <div class="gallery-header">
            <h1 class="gallery-title">ç²¾ç¾å›¾ç‰‡é›†</h1>
            <p class="gallery-subtitle">å‘ç°ç¾å¥½ï¼Œåˆ†äº«ç²¾å½©ï¼</p>
        </div>

        <div class="gallery-tags">
            <span class="gallery-tag active">å…¨éƒ¨</span>
            <span class="gallery-tag">é£æ™¯</span>
            <span class="gallery-tag">äººåƒ</span>
            <span class="gallery-tag">é™ç‰©</span>
            <span class="gallery-tag">å»ºç­‘</span>
            <span class="gallery-tag">åŠ¨ç‰©</span>
            <span class="gallery-tag">ç¾é£Ÿ</span>
            <span class="gallery-tag">è¡—æ‹</span>
        </div>

        <div class="carousel-container">
            <div class="carousel-track">
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/1.jpg" alt="è½®æ’­å›¾1">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/2.jpg" alt="è½®æ’­å›¾2">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/3.jpg" alt="è½®æ’­å›¾3">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/4.jpg" alt="è½®æ’­å›¾4">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/5.jpg" alt="è½®æ’­å›¾5">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/6.jpg" alt="è½®æ’­å›¾6">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/1.jpg" alt="è½®æ’­å›¾1">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/2.jpg" alt="è½®æ’­å›¾2">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/3.jpg" alt="è½®æ’­å›¾3">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/4.jpg" alt="è½®æ’­å›¾4">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/5.jpg" alt="è½®æ’­å›¾5">
                </div>
                <div class="carousel-slide">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/6.jpg" alt="è½®æ’­å›¾6">
                </div>
            </div>
        </div>

        <div class="gallery-stats">
            <div class="stat-item" onclick="openRatingModal()">
                <div class="stat-icon">â­</div>
                <div class="stat-value" id="ratingValue">4.8</div>
                <div class="stat-label">è¯„åˆ†</div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">ğŸ‘ï¸</div>
                <div class="stat-value">12.5K</div>
                <div class="stat-label">æµè§ˆ</div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">â¤ï¸</div>
                <div class="stat-value">3.2K</div>
                <div class="stat-label">æ”¶è—</div>
            </div>
            <div class="stat-item" onclick="openForum()">
                <div class="stat-icon">ğŸ’¬</div>
                <div class="stat-value" id="commentCount">0</div>
                <div class="stat-label">è¯„è®º</div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-button" onclick="startSlideshow()">å¼€å§‹æµè§ˆ</button>
            <button class="action-button download" onclick="downloadImage()">ä¸‹è½½å›¾ç‰‡</button>
            <a href="https://qm.qq.com/q/IekbXKmPAG" class="action-button service">è”ç³»ä½œè€…</a>
        </div>

        <div class="info-card">
            <h3>å›¾ç‰‡æè¿°</h3>
            <p class="description-text">
                è¿™æ˜¯ä¸€ç»„ç²¾å¿ƒæŒ‘é€‰çš„å›¾ç‰‡ï¼Œå±•ç°äº†ç‹¬ç‰¹çš„è‰ºæœ¯è§†è§’å’Œç²¾æ¹›çš„æ‹æ‘„æŠ€å·§ã€‚æ¯å¼ å›¾ç‰‡éƒ½ç»è¿‡ç²¾å¿ƒå¤„ç†ï¼Œç¡®ä¿æœ€ä½³çš„è§†è§‰æ•ˆæœã€‚
            </p>
        </div>

        <div class="image-gallery">
            <span class="gallery-close">&times;</span>
            <img class="gallery-image" src="" alt="é¢„è§ˆå›¾ç‰‡">
            <div class="image-info">
                <p class="image-description"></p>
            </div>
            <div class="gallery-navigation">
                <button class="gallery-nav prev">&lt;</button>
                <button class="gallery-nav next">&gt;</button>
            </div>
        </div>

        <div class="images-grid" id="images-grid">
            <!-- å›¾ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
        </div>

        <div class="info-card">
            <h3>å›¾ç‰‡ä¿¡æ¯</h3>
            <div class="image-details">
                <div class="detail-item">
                    <h4>æ‹æ‘„è®¾å¤‡</h4>
                    <p>ä¸“ä¸šå•åç›¸æœº</p>
                </div>
                <div class="detail-item">
                    <h4>åæœŸå¤„ç†</h4>
                    <p>ä¸“ä¸šè°ƒè‰²ä¸ä¿®é¥°</p>
                </div>
                <div class="detail-item">
                    <h4>å›¾ç‰‡å°ºå¯¸</h4>
                    <p>1920x1080</p>
                </div>
                <div class="detail-item">
                    <h4>æ–‡ä»¶æ ¼å¼</h4>
                    <p>JPG/PNG</p>
                </div>
            </div>
        </div>

        <div class="info-card">
            <h3>ç›¸å…³æ¨è</h3>
            <div class="related-images-grid">
                <a href="é£æ™¯æ‘„å½±.html" class="related-image-card">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/1.jpg" alt="é£æ™¯æ‘„å½±" loading="lazy">
                    <div class="image-info">
                        <h4>é£æ™¯æ‘„å½±</h4>
                        <p>è‡ªç„¶é£å…‰ç²¾é€‰</p>
                    </div>
                </a>
                <a href="äººåƒæ‘„å½±.html" class="related-image-card">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/2.jpg" alt="äººåƒæ‘„å½±" loading="lazy">
                    <div class="image-info">
                        <h4>äººåƒæ‘„å½±</h4>
                        <p>äººç‰©ç‰¹å†™ç²¾é€‰</p>
                    </div>
                </a>
                <a href="é™ç‰©æ‘„å½±.html" class="related-image-card">
                    <img src="../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/3.jpg" alt="é™ç‰©æ‘„å½±" loading="lazy">
                    <div class="image-info">
                        <h4>é™ç‰©æ‘„å½±</h4>
                        <p>é™ç‰©è‰ºæœ¯ç²¾é€‰</p>
                    </div>
                </a>
            </div>
        </div>

        <div class="rating-modal" id="ratingModal">
            <div class="rating-content">
                <h3>ä¸ºå›¾ç‰‡è¯„åˆ†</h3>
                <div class="rating-stars">
                    <span class="rating-star" data-value="1">â˜…</span>
                    <span class="rating-star" data-value="2">â˜…</span>
                    <span class="rating-star" data-value="3">â˜…</span>
                    <span class="rating-star" data-value="4">â˜…</span>
                    <span class="rating-star" data-value="5">â˜…</span>
                </div>
                <button class="rating-submit" onclick="submitRating()">æäº¤è¯„åˆ†</button>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <footer class="bottom-nav">
        <a href="æœ¨ç»µç»µOwO NO.028 æµ´å·¾å…”å­[42P].html" class="nav-item active" id="homeLink">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">é¦–é¡µ</span>
        </a>
        <a href="news.html" class="nav-item" id="newsLink" onclick="saveCurrentPage('news')">
            <span class="nav-icon">ğŸ“°</span>
            <span class="nav-text">æ–°é—»</span>
        </a>
        <a href="member.html" class="nav-item" id="memberLink" onclick="saveCurrentPage('member')">
            <span class="nav-icon">ğŸ‘¤</span>
            <span class="nav-text">ä¼šå‘˜</span>
        </a>
    </footer>


    <script>
        // å…¨å±€å˜é‡
        const imagePaths = [
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/1.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/2.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/3.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/4.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/5.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/6.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/7.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/8.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/9.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/10.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/11.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/12.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/13.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/14.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/15.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/16.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/17.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/18.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/19.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/20.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/21.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/22.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/23.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/24.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/25.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/26.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/27.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/28.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/29.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/30.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/31.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/32.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/33.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/34.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/35.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/36.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/37.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/38.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/39.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/40.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/41.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/42.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/43.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/44.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/45.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/46.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/47.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/48.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/49.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/50.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/51.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/52.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/53.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/54.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/55.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/56.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/57.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/58.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/59.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/60.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/61.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/62.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/63.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/64.jpg',
    '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/65.jpg',
];

        // æ£€æŸ¥ä¼šå‘˜çŠ¶æ€
        function checkMemberStatus() {
            // æ£€æŸ¥å¯†ç ç‰ˆæœ¬æ˜¯å¦åŒ¹é…
            const savedPasswordVersion = localStorage.getItem('passwordVersion');
            const currentPasswordVersion = '123456'; // è¿™é‡Œåº”è¯¥ä¸member.htmlä¸­çš„MEMBER_PASSWORDä¿æŒä¸€è‡´

            // å¦‚æœå¯†ç ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œè¯´æ˜åå°å¯†ç å·²æ›´æ”¹ï¼Œé‡ç½®ä¼šå‘˜çŠ¶æ€
            if (savedPasswordVersion !== currentPasswordVersion) {
                localStorage.setItem('isMember', 'false');
                console.log('å¯†ç å·²æ›´æ”¹ï¼Œä¼šå‘˜çŠ¶æ€å·²é‡ç½®');
            }

            return localStorage.getItem('isMember') === 'true';
        }

        // æ›´æ–°å›¾ç‰‡è®¿é—®æƒé™
        function updateImageAccess() {
            const isMember = checkMemberStatus();
            const imageCards = document.querySelectorAll('.image-card');

            imageCards.forEach((card, index) => {
                if (!isMember && index > 6) {
                    card.classList.add('locked');
                    card.innerHTML = `
                        <div class="locked-overlay">
                            <span class="lock-icon">ğŸ”’</span>
                            <p>ä¼šå‘˜ä¸“äº«</p>
                            <button class="unlock-btn">è§£é”æŸ¥çœ‹</button>
                        </div>
                    `;
                } else {
                    card.classList.remove('locked');
                }
            });
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // é¢„åŠ è½½æ‰€æœ‰å›¾ç‰‡
            const preloadedImages = [];
            imagePaths.forEach(path => {
                const img = new Image();
                img.src = path;
                preloadedImages.push(img);
            });

            // ç”Ÿæˆå›¾ç‰‡å¡ç‰‡
            const imagesGrid = document.querySelector('.images-grid');
            imagePaths.forEach((path, index) => {
                const card = document.createElement('div');
                card.className = 'image-card';
                card.innerHTML = `
                    <img src="${path}" alt="å›¾ç‰‡ ${index + 1}">
                `;
                imagesGrid.appendChild(card);
            });

            // æ›´æ–°å›¾ç‰‡è®¿é—®æƒé™
            updateImageAccess();

            // è®¾ç½®å›¾ç‰‡ç‚¹å‡»äº‹ä»¶
            setupGalleryEvents();
        });

        // è§£é”æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('unlock-btn')) {
                window.location.href = 'member.html';
            }
        });

        // å…¨å±€å˜é‡
        const imageFolderPath = '../image/å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P]/';
        const totalImages = 65;
        let currentGalleryIndex = 0;
        let galleryImages = [];
        let isGalleryOpen = false;
        let isTransitioning = false;

        function saveCurrentPage(pageType) {
            localStorage.setItem('lastPageType', pageType);
            localStorage.setItem('lastHomePage', 'å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P].html');
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function () {
            // ä¿å­˜å½“å‰é¡µé¢ä¸ºé¦–é¡µ
            localStorage.setItem('lastHomePage', 'å¹¼æ°´é“ƒè¡£ æ™¨é†’ [65P].html');

            // åˆå§‹åŒ–å›¾ç‰‡æ•°ç»„
            galleryImages = Array.from({ length: totalImages }, (_, i) => `${imageFolderPath}${i + 1}.jpg`);

            initializePage();
            setupEventListeners();
            loadImages();
            setupTheme();
            setupTags();
        });

        // åˆ›å»ºå›¾ç‰‡å¡ç‰‡
        function createImageCard(imagePath, index) {
            const isMember = checkMemberStatus();
            const card = document.createElement('div');
            card.className = 'image-card';

            if (!isMember && index > 6) {
                card.classList.add('locked');
                card.innerHTML = `
                    <div class="locked-overlay">
                        <span class="lock-icon">ğŸ”’</span>
                        <p>ä¼šå‘˜ä¸“äº«</p>
                        <button class="unlock-btn">è§£é”æŸ¥çœ‹</button>
                    </div>
                `;
                card.querySelector('.unlock-btn').addEventListener('click', () => {
                    window.location.href = 'member.html';
                });
            } else {
                card.innerHTML = `
                    <img src="${imagePath}" alt="å›¾ç‰‡${index + 1}" loading="lazy">
                `;
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                card.addEventListener('click', () => {
                    if (!isGalleryOpen) {
                        openGallery(index);
                    }
                });
            }

            return card;
        }

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            const imagesGrid = document.querySelector('.images-grid');
            imagesGrid.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            // åˆ›å»ºå›¾ç‰‡å¡ç‰‡
            for (let i = 0; i < totalImages; i++) {
                const imagePath = `${imageFolderPath}${i + 1}.jpg`;
                const card = createImageCard(imagePath, i);
                imagesGrid.appendChild(card);
            }
        }

        // è®¾ç½®æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
        function setupTags() {
            const tags = document.querySelectorAll('.gallery-tag');
            tags.forEach(tag => {
                tag.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
                    tags.forEach(t => t.classList.remove('active'));
                    // ä¸ºå½“å‰ç‚¹å‡»çš„æ ‡ç­¾æ·»åŠ activeç±»
                    tag.classList.add('active');
                    // è¿™é‡Œå¯ä»¥æ·»åŠ ç­›é€‰å›¾ç‰‡çš„é€»è¾‘
                });
            });
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // è¿”å›é¡¶éƒ¨æŒ‰é’®
            const backToTop = document.querySelector('.back-to-top');
            window.addEventListener('scroll', () => {
                backToTop.style.display = window.scrollY > 300 ? 'block' : 'none';
            });
            backToTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // ä¸»é¢˜åˆ‡æ¢
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.addEventListener('click', toggleTheme);

            // å›¾ç‰‡ç”»å»Š
            setupGalleryEvents();
        }

        // è®¾ç½®å›¾ç‰‡ç”»å»Šäº‹ä»¶
        function setupGalleryEvents() {
            const gallery = document.querySelector('.image-gallery');
            const closeBtn = document.querySelector('.gallery-close');
            const prevBtn = document.querySelector('.gallery-nav.prev');
            const nextBtn = document.querySelector('.gallery-nav.next');
            const galleryImg = document.querySelector('.gallery-image');

            // å…³é—­ç”»å»Š
            closeBtn.addEventListener('click', closeGallery);

            // ä¸Šä¸€å¼ /ä¸‹ä¸€å¼ 
            prevBtn.addEventListener('click', () => {
                if (!isTransitioning) navigateGallery(-1);
            });
            nextBtn.addEventListener('click', () => {
                if (!isTransitioning) navigateGallery(1);
            });

            // é”®ç›˜å¯¼èˆª
            document.addEventListener('keydown', (e) => {
                if (!isGalleryOpen || isTransitioning) return;

                switch (e.key) {
                    case 'ArrowLeft':
                        navigateGallery(-1);
                        break;
                    case 'ArrowRight':
                        navigateGallery(1);
                        break;
                    case 'Escape':
                        closeGallery();
                        break;
                }
            });

            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            gallery.addEventListener('click', (e) => {
                if (e.target === gallery && !isTransitioning) {
                    closeGallery();
                }
            });

            function closeGallery() {
                if (isTransitioning) return;
                gallery.classList.remove('active');
                setTimeout(() => {
                    gallery.style.display = 'none';
                    isGalleryOpen = false;
                    document.body.style.overflow = 'auto';
                }, 200);
            }

            function navigateGallery(direction) {
                if (isTransitioning) return;

                const isMember = checkMemberStatus();
                const nextIndex = (currentGalleryIndex + direction + galleryImages.length) % galleryImages.length;

                // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå…è´¹ç”¨æˆ·å¯é¢„è§ˆèŒƒå›´
                if (!isMember && nextIndex > 6) {
                    window.location.href = 'member.html';
                    return;
                }

                isTransitioning = true;
                galleryImg.style.opacity = '0';

                setTimeout(() => {
                    currentGalleryIndex = nextIndex;
                    galleryImg.src = galleryImages[currentGalleryIndex];
                    document.querySelector('.image-description').textContent = getImageDescription(currentGalleryIndex);
                    galleryImg.style.opacity = '1';
                    isTransitioning = false;
                }, 200);
            }
        }

        // è·å–å›¾ç‰‡æè¿°
        function getImageDescription(index) {
            const isMember = checkMemberStatus();
            if (!isMember && index > 6) {
                return "ä¼šå‘˜ä¸“äº«å†…å®¹ï¼Œè¯·å‡çº§ä¼šå‘˜åæŸ¥çœ‹";
            }

            const descriptions = [
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„é£æ™¯ç…§ç‰‡ï¼Œå±•ç°äº†è‡ªç„¶çš„å£®ä¸½æ™¯è‰²ã€‚',
    'äººç‰©ç‰¹å†™ï¼Œæ•æ‰äº†ç¬é—´çš„æƒ…æ„Ÿè¡¨è¾¾ã€‚',
    'é™ç‰©æ‘„å½±ï¼Œå±•ç°äº†ç‰©å“çš„è´¨æ„Ÿå’Œç»†èŠ‚ã€‚',
    'åŸå¸‚é£å…‰ï¼Œå±•ç°äº†ç°ä»£éƒ½å¸‚çš„ç¹åæ™¯è±¡ã€‚',
    'è‡ªç„¶é£å…‰ï¼Œå±•ç°äº†å±±å·æ²³æµçš„å£®ä¸½æ™¯è‰²ã€‚',
    'äººåƒæ‘„å½±ï¼Œå±•ç°äº†äººç‰©çš„è‡ªç„¶è¡¨æƒ…ã€‚',
    'é™ç‰©æ‘„å½±ï¼Œå±•ç°äº†ç‰©å“çš„è‰ºæœ¯ç¾æ„Ÿã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 8ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 9ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 10ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 11ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 12ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 13ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 14ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 15ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 16ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 17ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 18ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 19ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 20ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 21ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 22ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 23ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 24ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 25ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 26ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 27ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 28ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 29ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 30ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 31ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 32ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 33ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 34ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 35ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 36ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 37ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 38ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 39ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 40ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 41ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 42ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 43ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 44ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 45ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 46ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 47ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 48ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 49ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 50ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 51ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 52ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 53ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 54ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 55ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 56ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 57ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 58ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 59ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 60ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 61ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 62ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 63ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 64ã€‚',
    'è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ 65ã€‚',
];
            return descriptions[index] || "è¿™æ˜¯ä¸€å¼ ç²¾ç¾çš„ç…§ç‰‡ã€‚";
        }

        // å¼€å§‹æµè§ˆ
        function startSlideshow() {
            if (!isGalleryOpen) {
                const isMember = checkMemberStatus();
                if (!isMember) {
                    // éä¼šå‘˜åªèƒ½é¢„è§ˆå‰6å¼ å›¾ç‰‡
                    openGallery(0);
                } else {
                    // ä¼šå‘˜å¯ä»¥é¢„è§ˆæ‰€æœ‰å›¾ç‰‡
                    openGallery(0);
                }
            }
        }

        // æ‰“å¼€å›¾ç‰‡ç”»å»Š
        function openGallery(index) {
            if (isGalleryOpen || isTransitioning) return;

            const isMember = checkMemberStatus();
            if (!isMember && index > 6) {
                window.location.href = 'member.html';
                return;
            }

            const gallery = document.querySelector('.image-gallery');
            const galleryImg = document.querySelector('.gallery-image');
            const imageDescription = document.querySelector('.image-description');
            const bottomNav = document.querySelector('.bottom-nav');

            currentGalleryIndex = index;
            galleryImg.src = galleryImages[index];
            imageDescription.textContent = getImageDescription(index);
            gallery.style.display = 'flex';

            // éšè—åº•éƒ¨å¯¼èˆª
            if (bottomNav) {
                bottomNav.style.transform = 'translateY(100%)';
            }

            setTimeout(() => {
                gallery.classList.add('active');
                isGalleryOpen = true;
                document.body.style.overflow = 'hidden';
            }, 10);
        }

        // å…³é—­å›¾ç‰‡ç”»å»Š
        function closeGallery() {
            if (!isGalleryOpen || isTransitioning) return;

            isTransitioning = true;
            const gallery = document.querySelector('.image-gallery');
            const bottomNav = document.querySelector('.bottom-nav');

            gallery.classList.remove('active');

            // æ˜¾ç¤ºåº•éƒ¨å¯¼èˆª
            if (bottomNav) {
                bottomNav.style.transform = 'translateY(0)';
            }

            setTimeout(() => {
                gallery.style.display = 'none';
                isGalleryOpen = false;
                isTransitioning = false;
                document.body.style.overflow = '';
            }, 300);
        }

        // ä¸‹è½½å›¾ç‰‡
        function downloadImage() {
            const isMember = checkMemberStatus();
            if (!isMember && currentGalleryIndex > 6) {
                window.location.href = 'member.html';
                return;
            }

            const currentImage = galleryImages[currentGalleryIndex];
            const link = document.createElement('a');
            link.href = currentImage;
            link.download = `image-${currentGalleryIndex + 1}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            const body = document.body;
            const isDarkMode = body.classList.contains('dark-mode');

            if (isDarkMode) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                localStorage.setItem('theme', 'light');
                document.querySelector('.theme-toggle').textContent = 'åˆ‡æ¢æš—è‰²';
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
                document.querySelector('.theme-toggle').textContent = 'åˆ‡æ¢äº®è‰²';
            }
        }

        // è®¾ç½®ä¸»é¢˜
        function setupTheme() {
            const body = document.body;
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const themeToggle = document.querySelector('.theme-toggle');

            if (savedTheme === 'light' || (!savedTheme && !prefersDark)) {
                body.classList.add('light-mode');
                themeToggle.textContent = 'åˆ‡æ¢æš—è‰²';
            } else {
                body.classList.add('dark-mode');
                themeToggle.textContent = 'åˆ‡æ¢äº®è‰²';
            }
        }

        // æäº¤è¯„åˆ†
        function submitRating() {
            const isRated = localStorage.getItem('imageRated') === 'true';
            if (isRated) {
                alert('å·²ç»è¯„åˆ†è¿‡äº†ï¼');
                return;
            }

            const activeStars = document.querySelectorAll('.rating-star.active');
            const rating = activeStars.length;

            if (rating > 0) {
                localStorage.setItem('imageRated', 'true');
                localStorage.setItem('imageRating', rating);

                const ratingValue = document.getElementById('ratingValue');
                const currentRating = parseFloat(ratingValue.textContent);
                const newRating = ((currentRating * 856) + rating) / 857;
                ratingValue.textContent = newRating.toFixed(1);

                document.getElementById('ratingModal').style.display = 'none';
                alert('è¯„åˆ†å·²æäº¤ï¼Œæ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼');
            } else {
                alert('è¯·é€‰æ‹©è¯„åˆ†æ˜Ÿçº§ï¼');
            }
        }

        // æ‰“å¼€è¯„åˆ†æ¨¡æ€æ¡†
        function openRatingModal() {
            const isRated = localStorage.getItem('imageRated') === 'true';
            if (isRated) {
                alert('å·²ç»è¯„åˆ†è¿‡äº†ï¼');
                return;
            }

            const modal = document.getElementById('ratingModal');
            modal.style.display = 'flex';

            const savedRating = localStorage.getItem('imageRating');
            if (savedRating) {
                const stars = document.querySelectorAll('.rating-star');
                stars.forEach(star => {
                    if (parseInt(star.dataset.value) <= savedRating) {
                        star.classList.add('active');
                    }
                });
            }
        }

        // æ‰“å¼€è¯„è®ºè®ºå›
        function openForum() {
            const forumModal = document.createElement('div');
            forumModal.className = 'forum-modal';

            let savedComments = [];
            try {
                const savedCommentsStr = localStorage.getItem('imageComments');
                if (savedCommentsStr) {
                    savedComments = JSON.parse(savedCommentsStr);
                }
            } catch (e) {
                console.error('åŠ è½½è¯„è®ºå¤±è´¥:', e);
            }

            const hasSystemComments = savedComments.some(comment =>
                ['æ‘„å½±çˆ±å¥½è€…', 'è‰ºæœ¯è¯„è®ºå®¶', 'æ–°ç”¨æˆ·', 'èµ„æ·±ç”¨æˆ·', 'å›¾ç‰‡æ”¶è—å®¶'].includes(comment.author)
            );

            if (!hasSystemComments) {
                const systemComments = [
                    {
                        author: 'æ‘„å½±çˆ±å¥½è€…',
                        date: '2023-06-15',
                        content: 'è¿™ç»„ç…§ç‰‡çš„æ„å›¾å’Œå…‰çº¿å¤„ç†éå¸¸ä¸“ä¸šï¼Œç‰¹åˆ«æ˜¯è‰²å½©çš„è¿ç”¨å¾ˆæœ‰è‰ºæœ¯æ„Ÿã€‚',
                        likes: 128,
                        liked: false,
                        replies: []
                    },
                    {
                        author: 'è‰ºæœ¯è¯„è®ºå®¶',
                        date: '2023-06-10',
                        content: 'ç…§ç‰‡çš„æ„å¢ƒè¡¨è¾¾å¾ˆåˆ°ä½ï¼Œèƒ½å¤Ÿå¼•èµ·è§‚è€…çš„å…±é¸£ã€‚',
                        likes: 96,
                        liked: false,
                        replies: []
                    },
                    {
                        author: 'æ–°ç”¨æˆ·',
                        date: '2023-06-05',
                        content: 'ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¹ˆç²¾ç¾çš„ç…§ç‰‡ï¼Œæ¯ä¸€å¼ éƒ½å¾ˆæœ‰æ•…äº‹æ„Ÿã€‚',
                        likes: 75,
                        liked: false,
                        replies: []
                    },
                    {
                        author: 'èµ„æ·±ç”¨æˆ·',
                        date: '2023-06-01',
                        content: 'ç…§ç‰‡çš„åæœŸå¤„ç†å¾ˆä¸“ä¸šï¼Œç»†èŠ‚å¤„ç†å¾—å¾ˆåˆ°ä½ã€‚',
                        likes: 112,
                        liked: false,
                        replies: []
                    },
                    {
                        author: 'å›¾ç‰‡æ”¶è—å®¶',
                        date: '2023-05-28',
                        content: 'è¿™ç»„ç…§ç‰‡çš„è‰ºæœ¯ä»·å€¼å¾ˆé«˜ï¼Œå€¼å¾—æ”¶è—ã€‚',
                        likes: 89,
                        liked: false,
                        replies: []
                    }
                ];

                savedComments = [...systemComments, ...savedComments];
                localStorage.setItem('imageComments', JSON.stringify(savedComments));
            }

            let commentsHTML = '';
            savedComments.forEach(comment => {
                commentsHTML += `
                    <div class="forum-post">
                        <div class="post-header">
                            <span class="post-author">${comment.author}</span>
                            <span class="post-date">${comment.date}</span>
                        </div>
                        <div class="post-content">
                            ${comment.content}
                        </div>
                        <div class="post-actions">
                            <button class="like-btn" data-liked="${comment.liked || 'false'}">ğŸ‘ ç‚¹èµ (${comment.likes || 0})</button>
                            <button class="reply-btn">ğŸ’¬ å›å¤</button>
                        </div>
                        <div class="replies" style="display: none;">
                            <div class="reply-form">
                                <textarea placeholder="å›å¤è¯„è®º..." class="reply-textarea"></textarea>
                                <button class="submit-reply">å‘é€å›å¤</button>
                            </div>
                            <div class="reply-list">
                                ${comment.replies ? comment.replies.map(reply => `
                                    <div class="reply-item">
                                        <div class="reply-header">
                                            <span class="reply-author">${reply.author}</span>
                                            <span class="reply-date">${reply.date}</span>
                                        </div>
                                        <div class="reply-content">
                                            ${reply.content}
                                        </div>
                                    </div>
                                `).join('') : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            forumModal.innerHTML = `
                <div class="forum-content">
                    <div class="forum-header">
                        <h3>å›¾ç‰‡è¯„è®º</h3>
                        <button class="close-forum">&times;</button>
                    </div>
                    <div class="forum-body">
                        <div class="forum-stats">
                            <div class="forum-stat">
                                <span class="stat-icon">ğŸ“</span>
                                <span class="stat-value">${savedComments.length}</span>
                                <span class="stat-label">æ€»è¯„è®ºæ•°</span>
                            </div>
                            <div class="forum-stat">
                                <span class="stat-icon">ğŸ‘¥</span>
                                <span class="stat-value">1.2K</span>
                                <span class="stat-label">æ´»è·ƒç”¨æˆ·</span>
                            </div>
                        </div>
                        <div class="forum-posts">
                            ${commentsHTML}
                        </div>
                        <div class="new-post">
                            <textarea placeholder="å‘è¡¨ä½ çš„è¯„è®º..." class="post-textarea"></textarea>
                            <button class="submit-post">å‘å¸ƒè¯„è®º</button>
                        </div>
                    </div>
                </div>
            `;

            // æ·»åŠ æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                .forum-modal {
                    display: flex;
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 1000;
                    justify-content: center;
                    align-items: center;
                }

                .forum-content {
                    background: var(--card-bg);
                    width: 90%;
                    max-width: 800px;
                    max-height: 90vh;
                    border-radius: var(--border-radius);
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                }

                .forum-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px 20px;
                    background: var(--primary-color);
                    color: white;
                }

                .close-forum {
                    background: none;
                    border: none;
                    color: white;
                    font-size: 24px;
                    cursor: pointer;
                }

                .forum-body {
                    padding: 20px;
                    overflow-y: auto;
                }

                .forum-stats {
                    display: flex;
                    gap: 20px;
                    margin-bottom: 20px;
                }

                .forum-stat {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    padding: 10px 15px;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: var(--border-radius);
                }

                .forum-posts {
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                    margin-bottom: 20px;
                }

                .forum-post {
                    background: rgba(255, 255, 255, 0.1);
                    padding: 15px;
                    border-radius: var(--border-radius);
                }

                .post-header {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10px;
                    color: var(--primary-color);
                }

                .post-content {
                    margin-bottom: 10px;
                    line-height: 1.5;
                }

                .post-actions {
                    display: flex;
                    gap: 10px;
                }

                .post-actions button {
                    padding: 5px 10px;
                    border: none;
                    border-radius: 15px;
                    background: rgba(255, 255, 255, 0.1);
                    color: var(--text-color);
                    cursor: pointer;
                    transition: var(--transition);
                }

                .post-actions button:hover {
                    background: var(--primary-color);
                }

                .post-actions button.liked {
                    background: var(--primary-color);
                    color: white;
                }

                .replies {
                    margin-top: 15px;
                    padding-top: 15px;
                    border-top: 1px solid rgba(255, 255, 255, 0.1);
                }

                .reply-form {
                    margin-bottom: 15px;
                }

                .reply-textarea {
                    width: 100%;
                    height: 60px;
                    padding: 10px;
                    border: 1px solid var(--primary-color);
                    border-radius: var(--border-radius);
                    background: rgba(255, 255, 255, 0.1);
                    color: var(--text-color);
                    margin-bottom: 10px;
                    resize: vertical;
                }

                .submit-reply {
                    padding: 8px 15px;
                    background: var(--primary-color);
                    color: white;
                    border: none;
                    border-radius: 20px;
                    cursor: pointer;
                    transition: var(--transition);
                }

                .submit-reply:hover {
                    background: var(--secondary-color);
                }

                .reply-list {
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }

                .reply-item {
                    background: rgba(255, 255, 255, 0.05);
                    padding: 10px;
                    border-radius: var(--border-radius);
                }

                .reply-header {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 5px;
                    font-size: 0.9em;
                    color: var(--primary-color);
                }

                .reply-content {
                    font-size: 0.9em;
                    line-height: 1.4;
                }

                .new-post {
                    margin-top: 20px;
                }

                .post-textarea {
                    width: 100%;
                    height: 100px;
                    padding: 10px;
                    border: 1px solid var(--primary-color);
                    border-radius: var(--border-radius);
                    background: rgba(255, 255, 255, 0.1);
                    color: var(--text-color);
                    margin-bottom: 10px;
                    resize: vertical;
                }

                .submit-post {
                    padding: 10px 20px;
                    background: var(--primary-color);
                    color: white;
                    border: none;
                    border-radius: 20px;
                    cursor: pointer;
                    transition: var(--transition);
                }

                .submit-post:hover {
                    background: var(--secondary-color);
                }
            `;

            document.head.appendChild(style);
            document.body.appendChild(forumModal);

            // å…³é—­è®ºå›
            forumModal.querySelector('.close-forum').addEventListener('click', () => {
                document.body.removeChild(forumModal);
                document.head.removeChild(style);
            });

            // æäº¤è¯„è®º
            forumModal.querySelector('.submit-post').addEventListener('click', () => {
                const textarea = forumModal.querySelector('.post-textarea');
                const content = textarea.value.trim();

                if (content) {
                    const newComment = {
                        author: 'æˆ‘',
                        date: new Date().toISOString().split('T')[0],
                        content: content,
                        likes: 0,
                        liked: false,
                        replies: []
                    };

                    savedComments.unshift(newComment);
                    localStorage.setItem('imageComments', JSON.stringify(savedComments));

                    const forumCommentCount = forumModal.querySelector('.stat-value');
                    forumCommentCount.textContent = savedComments.length;

                    const pageCommentCount = document.getElementById('commentCount');
                    pageCommentCount.textContent = savedComments.length;

                    openForum();
                }
            });

            // è®¾ç½®ç‚¹èµå’Œå›å¤åŠŸèƒ½
            function setupPostEvents(post, commentIndex) {
                const likeBtn = post.querySelector('.like-btn');
                likeBtn.addEventListener('click', function () {
                    if (this.dataset.liked === 'false') {
                        const count = parseInt(this.textContent.match(/\((\d+)\)/)[1]);
                        this.textContent = `ğŸ‘ ç‚¹èµ (${count + 1})`;
                        this.dataset.liked = 'true';
                        this.classList.add('liked');

                        savedComments[commentIndex].likes = count + 1;
                        savedComments[commentIndex].liked = true;
                        localStorage.setItem('imageComments', JSON.stringify(savedComments));
                    }
                });

                const replyBtn = post.querySelector('.reply-btn');
                const replies = post.querySelector('.replies');
                replyBtn.addEventListener('click', () => {
                    replies.style.display = replies.style.display === 'none' ? 'block' : 'none';
                });

                const submitReply = post.querySelector('.submit-reply');
                submitReply.addEventListener('click', () => {
                    const textarea = post.querySelector('.reply-textarea');
                    const content = textarea.value.trim();

                    if (content) {
                        const newReply = {
                            author: 'æˆ‘',
                            date: new Date().toISOString().split('T')[0],
                            content: content
                        };

                        if (!savedComments[commentIndex].replies) {
                            savedComments[commentIndex].replies = [];
                        }
                        savedComments[commentIndex].replies.push(newReply);
                        localStorage.setItem('imageComments', JSON.stringify(savedComments));

                        openForum();
                    }
                });
            }

            forumModal.querySelectorAll('.forum-post').forEach((post, index) => {
                setupPostEvents(post, index);
            });
        }
    </script>
</body>

</html>